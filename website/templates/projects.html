
{% extends "layout.html" %}

{% block title %}Projects | Junseo Yang Portfolio{% endblock %}

{% block content %}
<section>
    <h2>üöÄ My Projects</h2>
    <p>Here are some of the exciting projects I've been working on:</p>
    
    <div class="sorting-controls">
        <div class="sort-group">
            <label for="sort-select">Sort by:</label>
            <select id="sort-select" onchange="updateSort()">
                <option value="default" {% if current_sort == 'default' %}selected{% endif %}>Project Name</option>
                <option value="latest_post" {% if current_sort == 'latest_post' %}selected{% endif %}>Latest Post</option>
                <option value="skill" {% if current_sort == 'skill' %}selected{% endif %}>Skill</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label for="skill-filter">Filter by skill:</label>
            <select id="skill-filter" onchange="updateSort()">
                <option value="">All Skills</option>
                {% for skill in all_skills %}
                <option value="{{ skill.name }}" {% if current_skill == skill.name %}selected{% endif %}>{{ skill.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    
    {% for project in projects %}
    <div class="project-card">
        <h3><a href="{{ url_for('views.project', project=project.title) }}">{{ project.title }}</a></h3>
        <p>{{ project.description }}</p>
        <p><strong>Status:</strong> <span class="status-{{ project.status.lower().replace(' ', '-') }}">{{ project.status }}</span></p>
        
        {% if project.posts %}
        {% set latest_post = project.posts|sort(attribute='date', reverse=true)|first %}
        <p><small>Latest post: {{ latest_post.date.strftime('%B %d, %Y') }}</small></p>
        {% endif %}
        
        {% if project.images %}
        <div class="project-images">
            {% if project.images|length > 1 %}
            <div class="carousel" id="project-{{ project.id }}-carousel">
                {% for image in project.images %}
                <div class="carousel-images">
                    <img src="{{ image.image_url }}" alt="{{ image.caption or project.title }}">
                    {% if image.caption %}<p>{{ image.caption }}</p>{% endif %}
                </div>
                {% endfor %}
                <div class="carousel-nav">
                    <button class="prev-btn">‚ùÆ Previous</button>
                    <button class="next-btn">Next ‚ùØ</button>
                </div>
            </div>
            <script>initCarousel('project-{{ project.id }}-carousel');</script>
            {% else %}
            <div class="single-image">
                <img src="{{ project.images[0].image_url }}" alt="{{ project.images[0].caption or project.title }}">
                {% if project.images[0].caption %}<p>{{ project.images[0].caption }}</p>{% endif %}
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        {% if project.skills %}
        <div class="skills-section">
            <h4>üõ†Ô∏è Technologies Used:</h4>
            {% for skill in project.skills %}
            <span class="skill-tag">{{ skill.name }}</span>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</section>

<script>
function updateSort() {
    const sortBy = document.getElementById('sort-select').value;
    const skillFilter = document.getElementById('skill-filter').value;
    
    const params = new URLSearchParams();
    if (sortBy !== 'default') params.set('sort', sortBy);
    if (skillFilter) params.set('skill', skillFilter);
    
    const queryString = params.toString();
    const newUrl = window.location.pathname + (queryString ? '?' + queryString : '');
    window.location.href = newUrl;
}
</script>
{% endblock %}